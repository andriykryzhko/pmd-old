<project name="pmd" default="compile" basedir="../">

<property name="lib" value="lib\"/>
<property name="src" value="src\"/>
<property name="build" value="build\"/>
<property name="rulesets" value="rulesets\"/>
<property name="test-data" value="test-data\"/>
<property name="regress" value="regress\"/>
<property name="reports" value="reports\"/>

	<target name="delete">
        <delete dir="${build}"/>
        <delete file="${lib}\pmd.jar"/>
        <mkdir dir="${build}"/>
    </target>

    <target name="compile">
        <javac  deprecation="false"
                debug="true"
                optimize="false"
                srcdir="${src}:${regress}"
                destdir="${build}">
        </javac>
	</target>

    <target name="jar">
        <mkdir dir="${lib}"/>
        <copy todir="${build}rulesets">
            <fileset dir="${rulesets}">
                <include name="*.xml"/>
                <include name="*.properties"/>
            </fileset>
        </copy>
        <jar jarfile="${lib}\pmd-0.6.jar" basedir="${build}" excludes="test/**/*.class"/>
    </target>

    <target name="pmd">
        <taskdef name="pmd" classname="net.sourceforge.pmd.ant.PMDTask"/>
        <pmd reportFile="c:\pmd.html" rulesetfiles="rulesets/design.xml,rulesets/unusedcode.xml,rulesets/basic.xml,rulesets/imports.xml" format="html">
            <fileset dir="c:\data\pmd\pmd\src">
            <!--<fileset dir="c:\j2sdk1.4.0\src\com\sun\corba">-->
            <!--<fileset dir="c:\j2sdk1.4.0\src\">-->
                <include name="**/*.java"/>
            </fileset>
        </pmd>
    </target>

    <target name="test" depends="compile">
        <junit printsummary="yes" haltonfailure="yes">
          <classpath>
            <pathelement location="${build}" />
            <pathelement location="${test-data}" />
            <pathelement location="${basedir}" />
          </classpath>

          <formatter type="plain" />

          <batchtest fork="no" todir="${build}">
            <fileset dir="${regress}">
              <include name="test/**/*Test.java" />
            </fileset>
          </batchtest>
        </junit>
    </target>

  <path id="quilt.classpath">
    <pathelement location="${lib.repo}/quilt-0.4.jar" />
    <pathelement location="${lib.repo}/bcel-5.1-dev.jar" />
    <pathelement location="${lib.repo}/commons-graph.jar" />
    <pathelement location="${lib.repo}/commons-collections.jar" />
    <pathelement location="${lib.repo}/colt.jar" />
  </path>

    <target name="cover">
        <taskdef name="quilt" classname="junit.quilt.ant.AntQuiltRunner" classpathref="quilt.classpath" />
        <quilt reportdir="${reports}"
                register="junit.quilt.cover.ball94.B94Registry"
                reporter="junit.quilt.reports.XMLSummary"
                packages="net.sourceforge.pmd">
          <classpath>
            <pathelement location="${build}" />
          </classpath>

            <fileset dir="${src}">
              <include name="**/*Test.java" />
            </fileset>
        </quilt>
    </target>

    <target name="jjtree">
        <jjtree target="etc/Java1.4-c.jjt" outputdirectory="src/net/sourceforge/pmd/ast" javacchome="c:/javacc2.1"/>
        <javacc target="src/net/sourceforge/pmd/ast/Java1.4-c.jj" outputdirectory="src/net/sourceforge/pmd/ast" javacchome="c:/javacc2.1"/>
        <delete file="src/net/sourceforge/pmd/ast/Java1.4-c.jj"/>
    </target>

    <target name="jjtree-2">
        <mkdir dir="tmp"/>
        <jjtree target="etc/Java1.4-c.jjt" outputdirectory="src/net/sourceforge/pmd/ast" javacchome="/home/dpeugh/software/javacc2.1"/>
        <javacc target="src/net/sourceforge/pmd/ast/Java1.4-c.jj" outputdirectory="src/net/sourceforge/pmd/ast" javacchome="/home/dpeugh/software/javacc2.1"/>
        <copy overwrite="yes" todir="src/net/sourceforge/pmd/ast">
            <fileset dir="tmp" includes="*.java"/>
        </copy>
        <delete file="src/net/sourceforge/pmd/ast/Java1.4-c.jj"/>
        <delete dir="tmp"/>
    </target>

	<target name="clean" depends="delete,compile"/>

    <target name="dist" depends="clean,jar"/>


</project>

